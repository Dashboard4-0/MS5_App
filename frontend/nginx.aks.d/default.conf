# MS5.0 Floor Dashboard - AKS Additional Nginx Configuration
# 
# This configuration provides additional settings for:
# - Tablet-specific optimizations
# - Factory environment support
# - Performance tuning
# - Security enhancements

# Tablet-specific optimizations
map $http_user_agent $is_tablet {
    default 0;
    ~*ipad 1;
    ~*android.*tablet 1;
    ~*tablet 1;
}

# Factory environment detection
map $http_x_factory_network $is_factory {
    default 0;
    "true" 1;
}

# Performance tuning for tablets
if ($is_tablet) {
    set $tablet_optimized "true";
}

# Factory environment settings
if ($is_factory) {
    set $factory_network "true";
}

# Security enhancements
add_header X-Robots-Tag "noindex, nofollow" always;

# Tablet-specific headers
add_header X-Tablet-Optimized $tablet_optimized always;
add_header X-Factory-Network $factory_network always;

# Performance monitoring headers
add_header X-Response-Time $request_time always;
add_header X-Upstream-Response-Time $upstream_response_time always;

# CORS configuration for API calls
add_header Access-Control-Allow-Origin "https://api.ms5dashboard.com" always;
add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS" always;
add_header Access-Control-Allow-Headers "Origin, X-Requested-With, Content-Type, Accept, Authorization" always;
add_header Access-Control-Allow-Credentials "true" always;

# Handle preflight requests
if ($request_method = 'OPTIONS') {
    add_header Access-Control-Allow-Origin "https://api.ms5dashboard.com";
    add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS";
    add_header Access-Control-Allow-Headers "Origin, X-Requested-With, Content-Type, Accept, Authorization";
    add_header Access-Control-Allow-Credentials "true";
    add_header Access-Control-Max-Age 86400;
    add_header Content-Length 0;
    add_header Content-Type text/plain;
    return 204;
}